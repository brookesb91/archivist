<!DOCTYPE html>
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Archivist || #{thread.posts[0].semantic_url}
    link(rel="stylesheet", href="/styles/styles.css")
    link(rel="stylesheet", href="/styles/thread.css")
    link(rel="stylesheet", href="https://fonts.googleapis.com/icon?family=Material+Icons")
  body

    .thread-page
      .thread-header
        .links
          a(href="/archive").link.back
            i.material-icons chevron_left
        .title
          span.thread-board="/" + thread.board + "/"
          span.thread-id=thread.thread
      .thread-meta
        span="Archived on "
          time(datetime=thread.createdAt)=thread.createdAt
        span="Updated on " + thread.updatedAt
      .thread
        .posts
          each post in thread.posts
            .post(id="p" + post.no)
              .post-meta
                if post.country
                  img.post-flag(src="https://www.countryflags.io/" + post.country + "/flat/16.png")
                .post-name=post.name
                if post.id
                  .post-id=post.id
                if post.sub
                  .post-subject=post.sub
                .post-time=post.now
                .post-no=post.no

              .post-content
                if post.filename && post.tim
                  .post-attachment
                    img.post-image(src="https://i.4cdn.org/" + thread.board + "/" + post.tim + "s.jpg", data-thumb="https://i.4cdn.org/" + thread.board + "/" + post.tim + "s.jpg", data-full="https://is2.4chan.org/" + thread.board + "/" + post.tim + post.ext, alt="", onclick="toggleImage(this)")
                .post-comment!=post.com

              .post-replies
    script.
      // TODO - Separate

      // Toggles image size.
      const toggleImage = (e) => {
        const thumb = e.getAttribute('data-thumb');
        const full = e.getAttribute('data-full');

        if(e.src === thumb){
          e.src = full;
        } else {
          e.src = thumb;
        }
      }

      // Add reply links to posts
      // TODO - Revise
      const quotes = document.querySelectorAll('.quotelink');

      quotes.forEach(quote => {
        const id = quote.closest('.post').getAttribute('id').split('p')[1];
        const link = quote.href.split('#')[1];
        const target = document.querySelector(`#${link}`);

        if (target) {
          const replies = target.querySelector('.post-replies');
          const el = document.createElement('a');
          el.classList.add('reply-link');
          el.innerText = `>>${id}`;
          el.href = `#p${id}`;
          replies.appendChild(el);
        } else {
          quote.removeAttribute('href');
          quote.style.textDecoration = 'line-through';
        }
      });
